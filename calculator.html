<!DOCTYPE html>
<html class="dark" lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="TDD와 SOLID 원칙을 적용한 공학용 계산기">
    <title>Scientific Calculator</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                        "surface-dark": "#1E2630",
                        "surface-accent": "#283039",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "2xl": "1rem",
                    },
                },
            },
        }
    </script>

    <style>
        body {
            min-height: max(884px, 100dvh);
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        button:active {
            transform: scale(0.96);
            transition: transform 0.05s ease;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-10px);
            }

            75% {
                transform: translateX(10px);
            }
        }

        .shake {
            animation: shake 0.3s ease-in-out;
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-white h-screen flex flex-col overflow-hidden selection:bg-primary/30">

    <!-- Header -->
    <header class="flex items-center justify-between p-4 pt-6 pb-2">
        <h2 class="text-xl font-bold leading-tight tracking-[-0.015em]">Scientific</h2>
        <button onclick="toggleHistory()"
            class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors">
            <span aria-label="History" class="material-symbols-outlined text-[24px]">history</span>
        </button>
    </header>

    <!-- Display Area -->
    <div class="flex-1 flex flex-col justify-end px-6 pb-4 min-h-0">
        <!-- Expression -->
        <div class="text-right pb-1 overflow-x-auto no-scrollbar whitespace-nowrap">
            <p id="expression"
                class="text-slate-500 dark:text-slate-400 text-lg font-normal leading-normal tracking-wide min-h-[28px]">
            </p>
        </div>
        <!-- Result -->
        <div class="text-right overflow-x-auto no-scrollbar whitespace-nowrap">
            <h1 id="result" class="text-6xl md:text-7xl font-bold leading-tight tracking-tight break-all">0</h1>
        </div>
    </div>

    <!-- Controls Area -->
    <div class="flex flex-col gap-4 px-4 pb-8 md:pb-12">
        <!-- Mode Toggle & Scientific Row -->
        <div class="flex justify-between items-center gap-3">
            <!-- RAD/DEG Toggle -->
            <div class="flex h-10 items-center rounded-lg bg-white dark:bg-surface-accent p-1 shadow-sm w-32 shrink-0">
                <label
                    class="flex cursor-pointer h-full flex-1 items-center justify-center rounded-[4px] has-[:checked]:bg-slate-200 dark:has-[:checked]:bg-background-dark has-[:checked]:shadow-sm transition-all">
                    <span class="text-xs font-semibold text-slate-600 dark:text-slate-300">RAD</span>
                    <input class="hidden" name="angle-mode" type="radio" value="RAD" onchange="setAngleMode('RAD')">
                </label>
                <label
                    class="flex cursor-pointer h-full flex-1 items-center justify-center rounded-[4px] has-[:checked]:bg-slate-200 dark:has-[:checked]:bg-background-dark has-[:checked]:shadow-sm transition-all">
                    <span class="text-xs font-semibold text-slate-600 dark:text-slate-300">DEG</span>
                    <input checked class="hidden" name="angle-mode" type="radio" value="DEG"
                        onchange="setAngleMode('DEG')">
                </label>
            </div>

            <!-- Scientific Helpers -->
            <div class="flex gap-2 flex-1 justify-end overflow-x-auto no-scrollbar">
                <button onclick="appendToExpression('sqrt(')"
                    class="h-10 px-3 min-w-[3rem] rounded-lg bg-white dark:bg-surface-accent text-slate-700 dark:text-slate-300 text-sm font-semibold hover:bg-slate-50 dark:hover:bg-opacity-80 transition-colors">√</button>
                <button onclick="appendToExpression('π')"
                    class="h-10 px-3 min-w-[3rem] rounded-lg bg-white dark:bg-surface-accent text-slate-700 dark:text-slate-300 text-sm font-semibold hover:bg-slate-50 dark:hover:bg-opacity-80 transition-colors">π</button>
                <button onclick="appendToExpression('^')"
                    class="h-10 px-3 min-w-[3rem] rounded-lg bg-white dark:bg-surface-accent text-slate-700 dark:text-slate-300 text-sm font-semibold hover:bg-slate-50 dark:hover:bg-opacity-80 transition-colors">^</button>
                <button onclick="appendToExpression('!')"
                    class="h-10 px-3 min-w-[3rem] rounded-lg bg-white dark:bg-surface-accent text-slate-700 dark:text-slate-300 text-sm font-semibold hover:bg-slate-50 dark:hover:bg-opacity-80 transition-colors">!</button>
            </div>
        </div>

        <!-- Main Keypad Grid -->
        <div class="grid grid-cols-4 gap-3 md:gap-4 h-auto">
            <!-- Row 1: Scientific Functions -->
            <button onclick="appendToExpression('sin(')"
                class="h-14 md:h-16 rounded-xl bg-white dark:bg-surface-accent text-slate-700 dark:text-slate-300 text-sm md:text-base font-semibold hover:bg-slate-50 dark:hover:brightness-110 shadow-sm border border-slate-100 dark:border-none">sin</button>
            <button onclick="appendToExpression('cos(')"
                class="h-14 md:h-16 rounded-xl bg-white dark:bg-surface-accent text-slate-700 dark:text-slate-300 text-sm md:text-base font-semibold hover:bg-slate-50 dark:hover:brightness-110 shadow-sm border border-slate-100 dark:border-none">cos</button>
            <button onclick="appendToExpression('tan(')"
                class="h-14 md:h-16 rounded-xl bg-white dark:bg-surface-accent text-slate-700 dark:text-slate-300 text-sm md:text-base font-semibold hover:bg-slate-50 dark:hover:brightness-110 shadow-sm border border-slate-100 dark:border-none">tan</button>
            <button onclick="appendToExpression('ln(')"
                class="h-14 md:h-16 rounded-xl bg-white dark:bg-surface-accent text-slate-700 dark:text-slate-300 text-sm md:text-base font-semibold hover:bg-slate-50 dark:hover:brightness-110 shadow-sm border border-slate-100 dark:border-none">ln</button>

            <!-- Row 2: Secondary Functions -->
            <button onclick="appendToExpression('(')"
                class="h-14 md:h-16 rounded-xl bg-white dark:bg-surface-accent text-slate-700 dark:text-slate-300 text-sm md:text-base font-semibold hover:bg-slate-50 dark:hover:brightness-110 shadow-sm border border-slate-100 dark:border-none">(</button>
            <button onclick="appendToExpression(')')"
                class="h-14 md:h-16 rounded-xl bg-white dark:bg-surface-accent text-slate-700 dark:text-slate-300 text-sm md:text-base font-semibold hover:bg-slate-50 dark:hover:brightness-110 shadow-sm border border-slate-100 dark:border-none">)</button>
            <button onclick="appendToExpression('log(')"
                class="h-14 md:h-16 rounded-xl bg-white dark:bg-surface-accent text-slate-700 dark:text-slate-300 text-sm md:text-base font-semibold hover:bg-slate-50 dark:hover:brightness-110 shadow-sm border border-slate-100 dark:border-none">log</button>
            <button onclick="appendToExpression('/')"
                class="h-14 md:h-16 rounded-xl bg-primary/10 dark:bg-surface-accent text-primary text-xl font-bold hover:bg-primary/20 dark:hover:brightness-110 shadow-sm border border-primary/10 dark:border-none">÷</button>

            <!-- Row 3: Numbers & Operators -->
            <button onclick="appendToExpression('7')"
                class="h-16 md:h-20 rounded-2xl bg-white dark:bg-surface-dark text-slate-900 dark:text-white text-2xl font-medium hover:bg-slate-50 dark:hover:bg-[#2A3441] shadow-sm border border-slate-100 dark:border-none">7</button>
            <button onclick="appendToExpression('8')"
                class="h-16 md:h-20 rounded-2xl bg-white dark:bg-surface-dark text-slate-900 dark:text-white text-2xl font-medium hover:bg-slate-50 dark:hover:bg-[#2A3441] shadow-sm border border-slate-100 dark:border-none">8</button>
            <button onclick="appendToExpression('9')"
                class="h-16 md:h-20 rounded-2xl bg-white dark:bg-surface-dark text-slate-900 dark:text-white text-2xl font-medium hover:bg-slate-50 dark:hover:bg-[#2A3441] shadow-sm border border-slate-100 dark:border-none">9</button>
            <button onclick="appendToExpression('*')"
                class="h-16 md:h-20 rounded-2xl bg-primary/10 dark:bg-surface-accent text-primary text-2xl font-bold hover:bg-primary/20 dark:hover:brightness-110 shadow-sm border border-primary/10 dark:border-none">×</button>

            <!-- Row 4: Numbers & Operators -->
            <button onclick="appendToExpression('4')"
                class="h-16 md:h-20 rounded-2xl bg-white dark:bg-surface-dark text-slate-900 dark:text-white text-2xl font-medium hover:bg-slate-50 dark:hover:bg-[#2A3441] shadow-sm border border-slate-100 dark:border-none">4</button>
            <button onclick="appendToExpression('5')"
                class="h-16 md:h-20 rounded-2xl bg-white dark:bg-surface-dark text-slate-900 dark:text-white text-2xl font-medium hover:bg-slate-50 dark:hover:bg-[#2A3441] shadow-sm border border-slate-100 dark:border-none">5</button>
            <button onclick="appendToExpression('6')"
                class="h-16 md:h-20 rounded-2xl bg-white dark:bg-surface-dark text-slate-900 dark:text-white text-2xl font-medium hover:bg-slate-50 dark:hover:bg-[#2A3441] shadow-sm border border-slate-100 dark:border-none">6</button>
            <button onclick="appendToExpression('-')"
                class="h-16 md:h-20 rounded-2xl bg-primary/10 dark:bg-surface-accent text-primary text-2xl font-bold hover:bg-primary/20 dark:hover:brightness-110 shadow-sm border border-primary/10 dark:border-none">-</button>

            <!-- Row 5: Numbers & Operators -->
            <button onclick="appendToExpression('1')"
                class="h-16 md:h-20 rounded-2xl bg-white dark:bg-surface-dark text-slate-900 dark:text-white text-2xl font-medium hover:bg-slate-50 dark:hover:bg-[#2A3441] shadow-sm border border-slate-100 dark:border-none">1</button>
            <button onclick="appendToExpression('2')"
                class="h-16 md:h-20 rounded-2xl bg-white dark:bg-surface-dark text-slate-900 dark:text-white text-2xl font-medium hover:bg-slate-50 dark:hover:bg-[#2A3441] shadow-sm border border-slate-100 dark:border-none">2</button>
            <button onclick="appendToExpression('3')"
                class="h-16 md:h-20 rounded-2xl bg-white dark:bg-surface-dark text-slate-900 dark:text-white text-2xl font-medium hover:bg-slate-50 dark:hover:bg-[#2A3441] shadow-sm border border-slate-100 dark:border-none">3</button>
            <button onclick="appendToExpression('+')"
                class="h-16 md:h-20 rounded-2xl bg-primary/10 dark:bg-surface-accent text-primary text-2xl font-bold hover:bg-primary/20 dark:hover:brightness-110 shadow-sm border border-primary/10 dark:border-none">+</button>

            <!-- Row 6: Bottom Controls -->
            <button onclick="clearAll()"
                class="h-16 md:h-20 rounded-2xl bg-white dark:bg-surface-accent text-red-500 text-xl font-bold hover:bg-red-50 dark:hover:bg-red-900/20 shadow-sm border border-slate-100 dark:border-none">AC</button>
            <button onclick="appendToExpression('0')"
                class="h-16 md:h-20 rounded-2xl bg-white dark:bg-surface-dark text-slate-900 dark:text-white text-2xl font-medium hover:bg-slate-50 dark:hover:bg-[#2A3441] shadow-sm border border-slate-100 dark:border-none">0</button>
            <button onclick="appendToExpression('.')"
                class="h-16 md:h-20 rounded-2xl bg-white dark:bg-surface-dark text-slate-900 dark:text-white text-2xl font-bold hover:bg-slate-50 dark:hover:bg-[#2A3441] shadow-sm border border-slate-100 dark:border-none">.</button>
            <button onclick="calculate()"
                class="h-16 md:h-20 rounded-2xl bg-primary text-white text-2xl font-bold hover:bg-blue-600 shadow-md shadow-primary/20">=</button>
        </div>

        <!-- Backspace Button -->
        <div class="flex justify-end pr-2 -mt-[5.5rem] md:-mt-[6.5rem] pointer-events-none relative z-10">
            <button onclick="backspace()"
                class="pointer-events-auto flex items-center justify-center w-12 h-10 text-primary hover:text-blue-400">
                <span class="material-symbols-outlined" style="font-size: 28px;">backspace</span>
            </button>
        </div>
    </div>

    <script>
        // Calculator State
        let currentExpression = '';
        let angleMode = 'DEG'; // DEG or RAD
        let history = [];

        // Update Display
        function updateDisplay() {
            document.getElementById('expression').textContent = currentExpression || '';
        }

        // Append to Expression
        function appendToExpression(value) {
            currentExpression += value;
            updateDisplay();
        }

        // Clear All
        function clearAll() {
            currentExpression = '';
            document.getElementById('result').textContent = '0';
            updateDisplay();
        }

        // Backspace
        function backspace() {
            currentExpression = currentExpression.slice(0, -1);
            updateDisplay();
        }

        // Set Angle Mode
        function setAngleMode(mode) {
            angleMode = mode;
        }

        // Calculate Result
        function calculate() {
            if (!currentExpression) return;

            try {
                // Replace symbols with JavaScript equivalents
                let expr = currentExpression
                    .replace(/π/g, Math.PI)
                    .replace(/sqrt\(/g, 'Math.sqrt(')
                    .replace(/sin\(/g, angleMode === 'DEG' ? 'Math.sin(toRadians(' : 'Math.sin(')
                    .replace(/cos\(/g, angleMode === 'DEG' ? 'Math.cos(toRadians(' : 'Math.cos(')
                    .replace(/tan\(/g, angleMode === 'DEG' ? 'Math.tan(toRadians(' : 'Math.tan(')
                    .replace(/ln\(/g, 'Math.log(')
                    .replace(/log\(/g, 'Math.log10(')
                    .replace(/\^/g, '**')
                    .replace(/!/g, ''); // Factorial not implemented in this simple version

                // Add closing parentheses for angle conversion if needed
                if (angleMode === 'DEG') {
                    expr = expr.replace(/toRadians\(/g, 'toRadians(');
                    // Count opening parens after toRadians and add closing
                    let count = 0;
                    let result = '';
                    for (let i = 0; i < expr.length; i++) {
                        result += expr[i];
                        if (expr.substring(i - 9, i + 1) === 'toRadians(') {
                            count = 1;
                            let j = i + 1;
                            while (j < expr.length && count > 0) {
                                if (expr[j] === '(') count++;
                                if (expr[j] === ')') count--;
                                result += expr[j];
                                j++;
                            }
                            result += ')'; // Close toRadians
                            i = j - 1;
                        }
                    }
                    expr = result;
                }

                // Helper function for degree to radian conversion
                function toRadians(degrees) {
                    return degrees * (Math.PI / 180);
                }

                // Evaluate expression
                const result = eval(expr);

                // Format result
                const formattedResult = Number.isInteger(result) ? result : parseFloat(result.toFixed(10));

                // Update display
                document.getElementById('result').textContent = formattedResult;

                // Add to history
                history.push({
                    expression: currentExpression,
                    result: formattedResult
                });

                // Keep only last 50 entries
                if (history.length > 50) {
                    history.shift();
                }

            } catch (error) {
                // Show error
                document.getElementById('result').textContent = 'Error';
                document.getElementById('result').classList.add('shake');
                setTimeout(() => {
                    document.getElementById('result').classList.remove('shake');
                }, 300);
            }
        }

        // Toggle History (placeholder)
        function toggleHistory() {
            if (history.length === 0) {
                alert('No history yet!');
                return;
            }

            let historyText = 'Calculation History:\n\n';
            history.slice(-10).reverse().forEach((entry, index) => {
                historyText += `${entry.expression} = ${entry.result}\n`;
            });
            alert(historyText);
        }

        // Keyboard Support
        document.addEventListener('keydown', (e) => {
            if (e.key >= '0' && e.key <= '9') {
                appendToExpression(e.key);
            } else if (e.key === '.') {
                appendToExpression('.');
            } else if (e.key === '+') {
                appendToExpression('+');
            } else if (e.key === '-') {
                appendToExpression('-');
            } else if (e.key === '*') {
                appendToExpression('*');
            } else if (e.key === '/') {
                e.preventDefault();
                appendToExpression('/');
            } else if (e.key === 'Enter') {
                e.preventDefault();
                calculate();
            } else if (e.key === 'Escape') {
                clearAll();
            } else if (e.key === 'Backspace') {
                e.preventDefault();
                backspace();
            }
        });
    </script>
</body>

</html>